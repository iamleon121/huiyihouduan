# 会议管理 - 新建会议功能开发计划 (TODO List)

## 目标
实现无纸化会议系统中的新建会议功能，允许用户创建会议并上传相关议题的PDF文件，确保信息正确存储到数据库中。

## 任务列表

### 1. 前端实现 (`static/huiyi-meeting.html`, `static/huiyi-meeting.js`)

- **[X] 新增会议基础功能:**
  - [X] 会议管理页面中的"新增会议"按钮 (`#add-meeting-btn`)。
  - [X] 设计并实现模态框 (`#meetingModal`) 用于填写新会议信息。
  - [X] 表单 (`#meetingForm`) 包含会议的基本信息（名称、介绍、时间）。
  - [X] 表单支持动态添加/删除议程项 (`#agendaItemsContainer`, `#addAgendaItemBtn`)。
  - [X] 实现表单提交逻辑：收集数据并调用后端 API。

- **[ ] 文件上传功能:**
  - [ ] 为每个议程项添加文件上传控件。
  - [ ] 实现文件选择和预览功能。
  - [ ] 添加文件类型限制（仅允许PDF）。
  - [ ] 添加文件大小限制和验证。
  - [ ] 显示上传进度指示器。
  - [ ] 允许删除已选择的文件。

- **[ ] 表单验证与提交:**
  - [ ] 添加必填字段验证（会议名称、时间等）。
  - [ ] 验证议程项信息（标题、报告人等）。
  - [ ] 验证文件上传状态。
  - [ ] 优化表单提交逻辑，处理文件上传和会议信息提交。
  - [ ] 添加提交状态指示器和错误处理。

- **[ ] UI/UX优化:**
  - [ ] 优化文件上传区域的视觉设计。
  - [ ] 添加拖放上传功能。
  - [ ] 改进表单布局，使其在移动设备上也能良好显示。
  - [ ] 添加表单字段提示和帮助信息。

### 2. 后端实现 (`main.py`, `crud.py`, `schemas.py`)

- **[ ] API扩展:**
  - [ ] 扩展现有的 `POST /api/meetings/` API，支持文件上传。
  - [ ] 创建新的API端点 `POST /api/meetings/{meeting_id}/agenda/{agenda_id}/files` 用于上传议题文件。
  - [ ] 实现文件上传处理逻辑，包括文件保存、重命名和路径记录。
  - [ ] 添加文件类型验证和大小限制。

- **[ ] 数据模型与验证:**
  - [ ] 更新 `schemas.py` 中的 `AgendaItem` 和 `AgendaItemCreate` 以包含文件信息。
  - [ ] 创建 `File` 或 `Document` 模型用于存储文件元数据。
  - [ ] 建立议程项与文件之间的关联关系。
  - [ ] 添加文件元数据验证（类型、大小、格式等）。

- **[ ] 文件存储:**
  - [ ] 设计文件存储结构（按会议ID和议程项ID组织）。
  - [ ] 实现文件保存逻辑，确保安全存储和唯一命名。
  - [ ] 添加文件访问控制，确保只有授权用户可以访问。
  - [ ] 实现文件删除逻辑（当议程项或会议被删除时）。

### 3. 数据库设计

- **[ ] 表结构设计:**
  - [ ] 创建 `files` 或 `documents` 表存储文件元数据。
  - [ ] 设计表字段：id, filename, original_filename, file_path, file_size, file_type, upload_time, agenda_item_id 等。
  - [ ] 建立与 `agenda_items` 表的外键关系。

- **[ ] 数据迁移:**
  - [ ] 编写数据库迁移脚本，添加新表和关系。
  - [ ] 测试迁移脚本，确保不影响现有数据。

### 4. 测试

- **[ ] 单元测试:**
  - [ ] 为文件上传API编写测试用例。
  - [ ] 测试文件验证逻辑。
  - [ ] 测试文件存储和检索功能。

- **[ ] 集成测试:**
  - [ ] 测试完整的会议创建流程，包括文件上传。
  - [ ] 测试边界情况（大文件、无效文件类型等）。

- **[ ] 手动测试:**
  - [ ] 测试创建包含多个议程项和文件的会议。
  - [ ] 测试文件上传失败的情况。
  - [ ] 测试在不同浏览器中的兼容性。

### 5. 部署与文档

- **[ ] 部署准备:**
  - [ ] 确保服务器有足够的存储空间用于文件存储。
  - [ ] 配置文件上传大小限制。
  - [ ] 设置适当的文件权限。

- **[ ] 文档:**
  - [ ] 更新API文档，包含新的文件上传端点。
  - [ ] 编写用户指南，说明如何上传和管理文件。
  - [ ] 记录文件存储结构和命名约定。

## 实现流程

1. **新建会议流程:**
   - 用户在会议管理页面 (`huiyi-meeting.html`) 点击"新增会议"按钮。
   - 打开模态框，填写会议基本信息（名称、介绍、时间）。
   - 添加一个或多个议程项，每个议程项包含标题、报告人、预计时长等信息。
   - 为每个议程项上传相关的PDF文件。
   - 提交表单，前端收集所有信息并发送到后端。
   - 后端验证数据，保存会议信息和议程项到数据库。
   - 处理文件上传，保存文件到服务器并记录文件元数据。
   - 返回成功或失败信息给前端。
   - 前端显示操作结果，成功则刷新会议列表。

2. **文件上传处理:**
   - 前端验证文件类型（仅PDF）和大小，参考文件管理页面 (`huiyi-document.html`) 中的文件上传模态框实现。
   - 使用FormData对象封装文件和相关元数据。
   - 发送到后端API。
   - 后端接收文件，进行二次验证。
   - 生成唯一文件名，保存到指定目录。
   - 记录文件元数据到数据库。
   - 建立与议程项的关联关系。
   - 返回文件ID和访问URL给前端。

## 注意事项

- 确保文件上传安全，防止恶意文件上传。
- 实现适当的错误处理和用户反馈。
- 考虑大文件上传的性能影响。
- 设计合理的文件存储结构，便于管理和访问。
- 实现文件的备份和恢复机制。